<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Why TanStack Query? - TipsyDrive Technology Choice</title>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-dark: #4338ca;
            --secondary: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --bg: #ffffff;
            --bg-card: #f8fafc;
            --bg-card-hover: #f1f5f9;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-muted);
            text-decoration: none;
            margin-bottom: 2rem;
            transition: color 0.2s;
        }
        .back-link:hover { color: var(--primary); }

        header {
            text-align: center;
            padding: 2rem 0 3rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 3rem;
        }

        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        header p { color: var(--text-muted); font-size: 1.1rem; }

        .selected-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: var(--secondary);
            border-radius: 9999px;
            font-weight: 600;
            margin-top: 1rem;
        }

        section { margin-bottom: 3rem; }

        h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary);
            display: inline-block;
        }

        h3 { font-size: 1.25rem; margin: 1.5rem 0 1rem; color: var(--secondary); }

        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover { transform: translateY(-2px); box-shadow: 0 8px 30px rgba(0,0,0,0.3); }

        .grid { display: grid; gap: 1.5rem; }
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }

        table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
        th, td { padding: 0.75rem 1rem; text-align: left; border-bottom: 1px solid var(--border); }
        th { background: var(--bg-card); color: var(--primary); font-weight: 600; }
        tr:hover { background: var(--bg-card-hover); }
        .winner { color: var(--secondary); font-weight: 500; }

        .alternative {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            margin-bottom: 1rem;
        }

        .alternative-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
        .alternative-name { font-size: 1.25rem; font-weight: 600; color: var(--warning); }
        .alternative-tag {
            padding: 0.25rem 0.75rem;
            background: var(--bg-card-hover);
            border-radius: 9999px;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .pros-cons { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem; }
        .pros h4 { color: var(--secondary); }
        .cons h4 { color: var(--danger); }
        .pros ul, .cons ul { list-style: none; margin-top: 0.5rem; }
        .pros li::before { content: '+ '; color: var(--secondary); font-weight: bold; }
        .cons li::before { content: '- '; color: var(--danger); font-weight: bold; }

        .bottom-line {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            border-left: 4px solid var(--secondary);
            margin-top: 2rem;
        }
        .bottom-line h3 { color: var(--secondary); margin-top: 0; }

        .feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .feature-item { padding: 1rem; background: var(--bg); border-radius: 8px; border-left: 3px solid var(--primary); }
        .feature-item h4 { color: var(--primary); margin-bottom: 0.5rem; font-size: 0.95rem; }
        .feature-item small { color: var(--text-muted); }

        pre {
            background: var(--bg);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            margin: 1rem 0;
        }

        code {
            background: var(--bg);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .container { padding: 1rem; }
            header h1 { font-size: 1.75rem; }
            .pros-cons { grid-template-columns: 1fr; }
        }
    </style>
    <script src="auth.js"></script>
</head>
<body>
    <div class="container">
        <a href="architecture-and-plan.html" class="back-link">
            <span>&larr;</span> Back to Architecture
        </a>

        <header>
            <h1>Why TanStack Query?</h1>
            <p>Technology choice justification for TipsyDrive data fetching</p>
            <div class="selected-badge">Current Selection: TanStack Query (React Query)</div>
        </header>

        <!-- What TanStack Query Handles -->
        <section>
            <h2>What TanStack Query Handles</h2>
            <div class="feature-grid">
                <div class="feature-item">
                    <h4>API Data Fetching</h4>
                    <small>Rides list, driver details, payment history from backend</small>
                </div>
                <div class="feature-item">
                    <h4>Caching</h4>
                    <small>Smart cache with stale-while-revalidate strategy</small>
                </div>
                <div class="feature-item">
                    <h4>Background Refetch</h4>
                    <small>Auto-refresh data when app comes to foreground</small>
                </div>
                <div class="feature-item">
                    <h4>Mutations</h4>
                    <small>Create ride, accept booking, update profile with optimistic updates</small>
                </div>
                <div class="feature-item">
                    <h4>Loading States</h4>
                    <small>isLoading, isFetching, isError handled automatically</small>
                </div>
                <div class="feature-item">
                    <h4>Pagination</h4>
                    <small>Infinite scroll for ride history, driver earnings</small>
                </div>
            </div>
            <p style="color: var(--text-muted); margin-top: 1rem; font-size: 0.9rem;">
                <strong>Note:</strong> TanStack Query handles <em>server state</em> (data from API). Client state (auth, UI) is managed by Redux Toolkit.
            </p>
        </section>

        <!-- Why TanStack Query Section -->
        <section>
            <h2>Why We Chose TanStack Query</h2>
            <div class="grid grid-2">
                <div class="card">
                    <h3>Key Advantages</h3>
                    <table>
                        <tr><th>Factor</th><th>Benefit</th></tr>
                        <tr><td>Auto Caching</td><td>No manual cache management - it just works</td></tr>
                        <tr><td>Deduplication</td><td>Multiple components requesting same data = 1 request</td></tr>
                        <tr><td>Background Updates</td><td>Data stays fresh without user action</td></tr>
                        <tr><td>Optimistic Updates</td><td>UI updates instantly, rolls back on error</td></tr>
                        <tr><td>DevTools</td><td>Excellent debugging with query inspector</td></tr>
                        <tr><td>React Native</td><td>First-class support with AppState integration</td></tr>
                    </table>
                </div>
                <div class="card">
                    <h3>Code Example</h3>
                    <pre>// Fetching rides with auto-refresh
const { data: rides, isLoading } = useQuery({
  queryKey: ['rides'],
  queryFn: () => api.getRides(),
  staleTime: 30_000, // Fresh for 30s
  refetchOnWindowFocus: true,
});

// Creating a ride with optimistic update
const createRide = useMutation({
  mutationFn: (data) => api.createRide(data),
  onSuccess: () => {
    queryClient.invalidateQueries(['rides']);
  },
});</pre>
                </div>
            </div>
        </section>

        <!-- TipsyDrive Use Cases -->
        <section>
            <h2>TipsyDrive-Specific Use Cases</h2>
            <div class="grid grid-2">
                <div class="card">
                    <h3>Customer App</h3>
                    <table>
                        <tr><td><code>useQuery(['rides'])</code></td><td>Ride history with pagination</td></tr>
                        <tr><td><code>useQuery(['ride', id])</code></td><td>Active ride details (polling every 5s)</td></tr>
                        <tr><td><code>useMutation</code></td><td>Create ride, cancel ride, rate driver</td></tr>
                        <tr><td><code>useQuery(['profile'])</code></td><td>User profile with saved addresses</td></tr>
                    </table>
                </div>
                <div class="card">
                    <h3>Driver App</h3>
                    <table>
                        <tr><td><code>useQuery(['earnings'])</code></td><td>Today's earnings, weekly summary</td></tr>
                        <tr><td><code>useQuery(['requests'])</code></td><td>Incoming ride requests (short poll)</td></tr>
                        <tr><td><code>useMutation</code></td><td>Accept/reject ride, complete ride</td></tr>
                        <tr><td><code>useQuery(['payouts'])</code></td><td>Payout history with infinite scroll</td></tr>
                    </table>
                </div>
            </div>
        </section>

        <!-- Comparison Table -->
        <section>
            <h2>Detailed Comparison</h2>
            <table>
                <thead>
                    <tr>
                        <th>Aspect</th>
                        <th>TanStack Query</th>
                        <th>SWR</th>
                        <th>RTK Query</th>
                        <th>Manual fetch</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Caching</td>
                        <td class="winner">Excellent (smart invalidation)</td>
                        <td>Good</td>
                        <td class="winner">Excellent</td>
                        <td>Manual</td>
                    </tr>
                    <tr>
                        <td>DevTools</td>
                        <td class="winner">Excellent</td>
                        <td>Basic</td>
                        <td>Redux DevTools</td>
                        <td>None</td>
                    </tr>
                    <tr>
                        <td>Mutations</td>
                        <td class="winner">First-class support</td>
                        <td>useSWRMutation</td>
                        <td class="winner">First-class</td>
                        <td>Manual</td>
                    </tr>
                    <tr>
                        <td>Optimistic Updates</td>
                        <td class="winner">Built-in</td>
                        <td>Manual</td>
                        <td class="winner">Built-in</td>
                        <td>Manual</td>
                    </tr>
                    <tr>
                        <td>Infinite Queries</td>
                        <td class="winner">useInfiniteQuery</td>
                        <td>useSWRInfinite</td>
                        <td>Manual setup</td>
                        <td>Manual</td>
                    </tr>
                    <tr>
                        <td>React Native</td>
                        <td class="winner">Excellent (AppState)</td>
                        <td>Good</td>
                        <td>Good</td>
                        <td>Manual</td>
                    </tr>
                    <tr>
                        <td>Bundle Size</td>
                        <td>~13KB</td>
                        <td class="winner">~4KB</td>
                        <td>Included in RTK</td>
                        <td>0KB</td>
                    </tr>
                    <tr>
                        <td>Learning Curve</td>
                        <td>Medium</td>
                        <td class="winner">Low</td>
                        <td>Medium-High</td>
                        <td>N/A</td>
                    </tr>
                    <tr>
                        <td>Flexibility</td>
                        <td class="winner">Framework agnostic</td>
                        <td>React/Preact</td>
                        <td>Redux only</td>
                        <td class="winner">Full control</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Alternatives Section -->
        <section>
            <h2>Alternative Options Considered</h2>

            <div class="alternative">
                <div class="alternative-header">
                    <span class="alternative-name">SWR (Stale-While-Revalidate)</span>
                    <span class="alternative-tag">Vercel's Solution</span>
                </div>
                <p style="color: var(--text-muted); margin-bottom: 1rem;">Lightweight data fetching library by Vercel with minimal API.</p>
                <div class="pros-cons">
                    <div class="pros">
                        <h4>Pros</h4>
                        <ul>
                            <li>Tiny bundle size (~4KB)</li>
                            <li>Very simple API</li>
                            <li>Great documentation</li>
                            <li>Perfect for simple use cases</li>
                            <li>Built by Vercel (Next.js team)</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <h4>Cons for TipsyDrive</h4>
                        <ul>
                            <li>Mutations are second-class citizen</li>
                            <li>Less powerful DevTools</li>
                            <li>Manual optimistic updates</li>
                            <li>Less control over cache invalidation</li>
                            <li>Infinite queries less intuitive</li>
                        </ul>
                    </div>
                </div>
                <p style="margin-top: 1rem; padding: 0.75rem; background: var(--bg); border-radius: 8px; font-size: 0.9rem;">
                    <strong style="color: var(--warning);">When to use:</strong> Simple apps with mostly read operations, or when bundle size is critical.
                </p>
            </div>

            <div class="alternative">
                <div class="alternative-header">
                    <span class="alternative-name">RTK Query</span>
                    <span class="alternative-tag">Redux Toolkit Add-on</span>
                </div>
                <p style="color: var(--text-muted); margin-bottom: 1rem;">Data fetching solution built into Redux Toolkit with automatic cache management.</p>
                <div class="pros-cons">
                    <div class="pros">
                        <h4>Pros</h4>
                        <ul>
                            <li>Integrated with Redux store</li>
                            <li>Uses Redux DevTools</li>
                            <li>Auto-generated hooks from API definition</li>
                            <li>Good for teams already using Redux</li>
                            <li>Normalized caching</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <h4>Cons for TipsyDrive</h4>
                        <ul>
                            <li>Requires more boilerplate (API slices)</li>
                            <li>Tightly coupled to Redux</li>
                            <li>Harder to use without Redux</li>
                            <li>More complex mental model</li>
                            <li>Overkill when using Redux for client state only</li>
                        </ul>
                    </div>
                </div>
                <p style="margin-top: 1rem; padding: 0.75rem; background: var(--bg); border-radius: 8px; font-size: 0.9rem;">
                    <strong style="color: var(--warning);">When to use:</strong> When you want everything in Redux, or need normalized caching for complex relational data.
                </p>
            </div>

            <div class="alternative">
                <div class="alternative-header">
                    <span class="alternative-name">Apollo Client</span>
                    <span class="alternative-tag">GraphQL</span>
                </div>
                <p style="color: var(--text-muted); margin-bottom: 1rem;">Full-featured GraphQL client with powerful caching and state management.</p>
                <div class="pros-cons">
                    <div class="pros">
                        <h4>Pros</h4>
                        <ul>
                            <li>Normalized cache (entity-based)</li>
                            <li>Optimistic UI built-in</li>
                            <li>Excellent for GraphQL APIs</li>
                            <li>Local state management included</li>
                            <li>Great DevTools</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <h4>Cons for TipsyDrive</h4>
                        <ul>
                            <li>We're using REST, not GraphQL</li>
                            <li>Large bundle size</li>
                            <li>Overkill for REST APIs</li>
                            <li>Complex setup for non-GraphQL</li>
                            <li>Steeper learning curve</li>
                        </ul>
                    </div>
                </div>
                <p style="margin-top: 1rem; padding: 0.75rem; background: var(--bg); border-radius: 8px; font-size: 0.9rem;">
                    <strong style="color: var(--warning);">When to use:</strong> When using GraphQL as your API layer.
                </p>
            </div>

            <div class="alternative">
                <div class="alternative-header">
                    <span class="alternative-name">Manual fetch + useState</span>
                    <span class="alternative-tag">No Library</span>
                </div>
                <p style="color: var(--text-muted); margin-bottom: 1rem;">Using native fetch API with React state hooks.</p>
                <div class="pros-cons">
                    <div class="pros">
                        <h4>Pros</h4>
                        <ul>
                            <li>Zero dependencies</li>
                            <li>Full control over behavior</li>
                            <li>No abstraction to learn</li>
                            <li>Works with any setup</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <h4>Cons for TipsyDrive</h4>
                        <ul>
                            <li>Must implement caching manually</li>
                            <li>Loading/error states boilerplate</li>
                            <li>No request deduplication</li>
                            <li>No background refetching</li>
                            <li>Race conditions are your problem</li>
                            <li>Lots of repetitive code</li>
                        </ul>
                    </div>
                </div>
                <p style="margin-top: 1rem; padding: 0.75rem; background: var(--bg); border-radius: 8px; font-size: 0.9rem;">
                    <strong style="color: var(--warning);">When to use:</strong> Very simple apps with few API calls, or when you want to avoid any external dependencies.
                </p>
            </div>
        </section>

        <!-- Bottom Line -->
        <div class="bottom-line">
            <h3>Bottom Line</h3>
            <p>For TipsyDrive's data fetching - requiring <strong>real-time ride updates, paginated lists, and optimistic mutations</strong> - TanStack Query provides:</p>
            <ul style="margin: 1rem 0; padding-left: 1.5rem;">
                <li>Automatic caching with smart invalidation</li>
                <li>Background refetching when app comes to foreground (great for ride status)</li>
                <li>First-class mutation support with optimistic updates</li>
                <li>Built-in infinite queries for ride history pagination</li>
                <li>Excellent DevTools for debugging cache state</li>
                <li>Works seamlessly with React Native's AppState</li>
            </ul>
            <p style="color: var(--text-muted); font-size: 0.9rem; margin-top: 1rem;">
                <strong>Architecture note:</strong> TanStack Query + Redux Toolkit is the recommended modern pattern: TanStack Query for server state (API data), Redux for client state (auth, UI). This avoids the anti-pattern of caching server data in Redux.
            </p>
        </div>

        <footer style="text-align: center; padding: 3rem 0; border-top: 1px solid var(--border); margin-top: 3rem; color: var(--text-muted);">
            <a href="architecture-and-plan.html" style="color: var(--primary); text-decoration: none;">&larr; Back to Architecture & Plan</a>
        </footer>
    </div>
</body>
</html>
